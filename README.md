# Gest√£o Inteligente e Inovadora de Enfermarias: Solu√ß√£o para Continua√ß√£o de Cuidados

![Python Version](https://img.shields.io/badge/python-3.11-blue)
![Django Version](https://img.shields.io/badge/django-4.2-darkgreen)
![Docker Supported](https://img.shields.io/badge/docker-%20compatible-blue?logo=docker)
![License](https://img.shields.io/badge/license-MIT-green)

Sistema de conting√™ncia para garantir acesso cont√≠nuo a dados cl√≠nicos durante per√≠odos de *downtime* de Registos Eletr√≥nicos de Sa√∫de (EHR).

---

## üìÑ Sobre o Projeto

Este reposit√≥rio cont√©m o c√≥digo-fonte desenvolvido como parte da **Disserta√ß√£o de Mestrado em Engenharia Biom√©dica** (Ramo: Inform√°tica M√©dica) da **Universidade do Minho**.

* **Autor:** Bernardo Tardin de Moraes
* **Orientadores:**
    * Prof. Doutor Hugo Daniel Abreu Peixoto
    * Prof¬™. Doutora Ana Regina Coelho de Sousa
* **Ano:** 2025
* **Institui√ß√£o:** Escola de Engenharia, Universidade do Minho, Braga, Portugal

üìö **Disserta√ß√£o completa:** (dispon√≠vel ap√≥s aprova√ß√£o)

---

## üéØ Objetivo

O sistema foi desenvolvido para mitigar os riscos associados a per√≠odos de indisponibilidade (*downtime*) dos sistemas EHR hospitalares, causados por manuten√ß√µes programadas, falhas t√©cnicas ou ciberataques.

A solu√ß√£o oferece **duas modalidades complementares** de acesso √† informa√ß√£o cl√≠nica:

1.  **Interface Web:** Consulta em tempo real dos dados dos utentes internados, com filtros contextuais por **especialidade** (ou visualiza√ß√£o de **todas** as especialidades).
2.  **Sistema de Conting√™ncia Offline:** Exporta√ß√£o autom√°tica e peri√≥dica de relat√≥rios cl√≠nicos em formato PDF, organizados hierarquicamente por **especialidade**, **sala** e **cama/utente** (`<Especialidade>/<Sala>/<Cama>_<ID-Epis√≥dio>_<Nome-Utente>.pdf`), garantindo acesso mesmo durante falhas totais do sistema principal.

---

## ‚ú® Caracter√≠sticas Principais

* **üèóÔ∏è Arquitetura Modular e Configur√°vel:**
    * Camada de Acesso a Dados (DAL) agn√≥stica ao esquema da base de dados.
    * Adapta√ß√£o a diferentes infraestruturas via ficheiro JSON externo.
    * Suporte para Oracle, PostgreSQL, SQL Server sem altera√ß√£o de c√≥digo.
* **‚ö° Processamento Ass√≠ncrono Resiliente:**
    * Sistema de tarefas em *background* com Celery e RabbitMQ.
    * Exporta√ß√£o peri√≥dica automatizada de relat√≥rios PDF.
    * Mecanismo de retentativa autom√°tica em caso de falhas.
    * Escalabilidade horizontal atrav√©s de m√∫ltiplos *workers*.
* **üîí Seguran√ßa e Isolamento:**
    * Arquitetura multi-base de dados com acesso *read-only* √† base hospitalar.
    * Isolamento entre dados operacionais (SQLite) e dados cl√≠nicos.
    * Sistema de autentica√ß√£o e gest√£o de estado por sess√£o.
* **üê≥ Deployment Simplificado:**
    * Containeriza√ß√£o completa com Docker.
    * Orquestra√ß√£o de servi√ßos com Docker Compose.
    * Ambiente reprodut√≠vel e port√°til.
* **üìä Interface Intuitiva:**
    * Sele√ß√£o contextual por especialidade ou visualiza√ß√£o global.
    * Pesquisa (ID/Nome) e pagina√ß√£o de utentes.
    * Gera√ß√£o de relat√≥rios *on-demand*.

---

## üèÜ Resultados de Valida√ß√£o

A solu√ß√£o foi avaliada atrav√©s de metodologia mista com profissionais t√©cnicos experientes em sistemas hospitalares, utilizando dados reais.

| Dimens√£o                  | M√©trica             | Resultado           | Classifica√ß√£o |
| :------------------------ | :------------------ | :------------------ | :------------ |
| Usabilidade               | SUS                 | **71.7 / 100*** | Bom (B)       |
| Utilidade Percebida       | TAM/UTAUT           | **86.7%** concord.  | Elevada       |
| Efici√™ncia - Interface Web | Escala Likert (1-5) | **4.22 / 5.0** | Muito Boa     |
| Efici√™ncia - Conting√™ncia PDF | Escala Likert (1-5) | **4.22 / 5.0** | Muito Boa     |
| Satisfa√ß√£o Global         | Escala 1-10‚Ä†        | **7.67 / 10** | Satisfeito    |
<br/>
<small>*Pontua√ß√£o SUS (escala 0-100)</small>
<small>‚Ä†Escala 1-10</small>


### üéñÔ∏è Destaques da Avalia√ß√£o

* ‚úÖ Pontua√ß√£o SUS **acima da m√©dia de refer√™ncia** (68 pontos).
* ‚úÖ **Concord√¢ncia un√¢nime** sobre facilita√ß√£o de acesso em situa√ß√µes cr√≠ticas (Item 13, M=4.67).
* ‚úÖ **Equival√™ncia estat√≠stica** entre efici√™ncia dos cen√°rios *online* (M=4.22) e *offline* (M=4.22).
* ‚úÖ **100% de concord√¢ncia** sobre organiza√ß√£o hier√°rquica dos ficheiros PDF (Item 21, M=4.33).

*Detalhes completos no Cap√≠tulo 6 da disserta√ß√£o.*

---

## üõ†Ô∏è Stack Tecnol√≥gica

* **Backend:** Python 3.11, Django 4.2, Celery 5.3, RabbitMQ, WeasyPrint
* **Frontend:** Django Templates (SSR), HTML5/CSS3, JavaScript (vanilla)
* **Base de Dados:** SQLite (interna), Oracle / PostgreSQL / SQL Server (externa)
* **Infrastructure:** Docker & Docker Compose, Nginx, Gunicorn

---

## üìã Pr√©-requisitos

Antes de come√ßar, garanta que tem o seguinte instalado e configurado:

1.  **Docker Engine:** Vers√£o 20.10 ou superior. [Instru√ß√µes de Instala√ß√£o](https://docs.docker.com/engine/install/)
2.  **Docker Compose:** Vers√£o 2.0 ou superior (geralmente inclu√≠do com o Docker Desktop). [Instru√ß√µes de Instala√ß√£o](https://docs.docker.com/compose/install/)
3.  **Acesso √† Base de Dados Hospitalar:**
    * Credenciais de um utilizador com permiss√µes de **leitura (read-only)**.
    * Detalhes da conex√£o (Host/IP, Porta, Nome do Servi√ßo/SID - **recomendado Service Name**).
    * **VPN Ativa:** Se a base de dados n√£o for acess√≠vel publicamente, certifique-se de que a sua conex√£o VPN (ex: GlobalProtect) est√° ativa e configurada corretamente.
4.  **Recursos do Sistema:**
    * M√≠nimo 4GB de RAM dispon√≠vel para os contentores Docker.
    * Espa√ßo em disco suficiente para a imagem Docker, depend√™ncias e, crucialmente, para o armazenamento dos ficheiros PDF gerados (depende do n√∫mero de utentes e frequ√™ncia de backup).

---

## üöÄ Instala√ß√£o e Configura√ß√£o Detalhada

### 1. Clonar o Reposit√≥rio

Abra o seu terminal e clone o reposit√≥rio para a sua m√°quina local:
```bash
git clone [https://github.com/](https://github.com/)[seu-usuario]/ward-data-portal.git
cd ward-data-portal
````

### 2\. Configurar Vari√°veis de Ambiente (`.env`)

Este √© um passo crucial para a seguran√ßa e funcionamento da aplica√ß√£o. Copie o ficheiro de exemplo:

```bash
# Linux/macOS
cp .env.example .env
# Windows
copy .env.example .env
```

Agora, **edite o ficheiro `.env`** que acabou de criar na raiz do projeto. Preencha **todas** as vari√°veis. Consulte a sec√ß√£o **Configura√ß√£o Avan√ßada (`.env`)** abaixo para detalhes sobre cada vari√°vel. As mais importantes s√£o:

  * `DJANGO_SECRET_KEY`: Gere uma nova chave aleat√≥ria.
  * `DB_TYPE`: `oracle`, `postgres` ou `sqlserver`.
  * Credenciais da BD Externa (`SQL_DSN` ou `SQL_HOST`/`PORT`/`DB_NAME`, `SQL_USER`, `SQL_PASSWORD`).
  * `HOST_BACKUP_DIR`: Caminho na sua m√°quina onde os PDFs ser√£o guardados.

üîê **Gerar chave secreta Django:**

```bash
python -c "from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())"
```

### 3\. Configurar Queries da Base de Dados (`config.json`)

‚ö†Ô∏è **PASSO CR√çTICO:** Este ficheiro mapeia a l√≥gica da aplica√ß√£o ao esquema espec√≠fico da sua base de dados.

  * Abra o ficheiro `configs/config.json`.
  * **Reescreva TODAS as queries SQL** na sec√ß√£o `"queries"` para funcionarem com a sua base de dados.
  * Verifique e ajuste os mapeamentos na sec√ß√£o `"columns"`.

üìñ **Instru√ß√µes detalhadas e exemplos:** Consulte a sec√ß√£o **Configura√ß√£o Avan√ßada (`config.json`)** abaixo para um guia completo. **A aplica√ß√£o N√ÉO FUNCIONAR√Å se este passo n√£o for feito corretamente.**

### 4\. Construir a Imagem Docker

Este comando ir√° construir a imagem da aplica√ß√£o, instalando as depend√™ncias corretas com base no `DB_TYPE` que definiu no `.env`. Execute no terminal, na raiz do projeto:

```bash
# Substitua 'oracle' pelo seu DB_TYPE se for diferente
docker compose build --build-arg DB_TYPE=oracle
```

*Este processo pode demorar alguns minutos na primeira vez.*

### 5\. Iniciar os Servi√ßos

Execute o seguinte comando para iniciar todos os contentores (Nginx, Django, Celery, RabbitMQ) em background:

```bash
docker compose up -d
```

Aguarde um pouco at√© que todos os servi√ßos estejam a funcionar (pode verificar com `docker compose ps`).

### 6\. Criar Utilizador Administrador

Para poder aceder √† aplica√ß√£o, crie a primeira conta de utilizador (administrador):

```bash
docker compose exec web python manage.py createsuperuser
```

Siga as instru√ß√µes no terminal para definir um nome de utilizador, email (opcional) e password.

-----

## ‚öôÔ∏è Configura√ß√£o Avan√ßada

### Vari√°veis de Ambiente (`.env`)

O ficheiro `.env`, localizado na raiz do projeto, controla o comportamento da aplica√ß√£o e dos seus servi√ßos. Certifique-se de que este ficheiro **n√£o √© versionado** no Git por quest√µes de seguran√ßa.

  * `DJANGO_SECRET_KEY`: **Obrigat√≥rio.** Chave secreta √∫nica para a sua inst√¢ncia Django.
  * `DB_TYPE`: **Obrigat√≥rio.** Define o tipo de base de dados externa (`oracle`, `postgres`, `sqlserver`). Usado no build.
  * **Configura√ß√£o da Base de Dados Externa:**
      * **M√©todo 1: DSN (Recomendado Oracle com Service Name)**
          * `SQL_DSN`: String de conex√£o TNS completa. Ex: `"(DESCRIPTION=(...)(SERVICE_NAME=aida))"`
          * `SQL_USER`, `SQL_PASSWORD`: Credenciais read-only.
          * *Deixe `SQL_HOST`, `SQL_PORT`, `SQL_DB_NAME` vazios.*
      * **M√©todo 2: Campos Separados (Postgres, SQL Server, Oracle com SID)**
          * `SQL_HOST`, `SQL_PORT`, `SQL_DB_NAME`: Detalhes da conex√£o.
          * `SQL_USER`, `SQL_PASSWORD`: Credenciais read-only.
          * *Deixe `SQL_DSN` vazio.*
  * `CELERY_BROKER_URL`: URL do RabbitMQ (formato: `amqp://user:pass@host:port/vhost`). Padr√£o: `amqp://admin:admin123@rabbitmq:5672/`
  * `RABBITMQ_DEFAULT_USER`, `RABBITMQ_DEFAULT_PASS`: Credenciais para a interface de gest√£o do RabbitMQ. Use passwords seguras.
  * `HOSPITAL_CONFIG_PATH`: Caminho *dentro do container* para `config.json` (Padr√£o: `configs/config.json`). N√£o alterar geralmente.
  * `BACKUP_INTERVAL`: Frequ√™ncia do backup autom√°tico (em segundos). Padr√£o: `7200` (2 horas).
  * `HOST_BACKUP_DIR`: Caminho absoluto **na sua m√°quina (host)** para guardar os PDFs. Ex: `~/Desktop/pdfs_backup` ou `C:/Users/User/Documents/pdfs_backup`.
  * `OFFLINE_BACKUP_DIR`: Caminho *dentro do container* onde a app escreve PDFs (Padr√£o: `/app/pdfs`). **N√£o alterar**.
  * `DJANGO_ALLOWED_HOSTS`: Hosts permitidos (separados por v√≠rgula). Ex: `localhost,127.0.0.1,meudominio.com`.
  * `DJANGO_DEBUG`: `True` (desenvolvimento) ou `False` (produ√ß√£o).

### Configura√ß√£o das Queries (`config.json`)

‚ö†Ô∏è **ESTE FICHIRO √â CR√çTICO.** Adapte-o ao seu ambiente hospitalar.

**Estrutura:**

```json
{
  "queries": { "chave_interna": "SELECT ...", ... },
  "columns": { "chave_interna_app": "NOME_COLUNA_BD", ... },
  "sorting": { "contexto": { "chave_app": "NOME_COLUNA_BD_SORT" } },
  "parameters": { "chave": "valor_constante" }
}
```

**Regras Obrigat√≥rias:**

1.  **Nomes das Colunas:** As suas queries **DEVEM** retornar colunas com os nomes **EXATOS** que est√£o definidos como **VALORES** na sec√ß√£o `"columns"`. Use `AS` se necess√°rio.
2.  **Par√¢metros:** Utilize **SEMPRE `%s`** como marcador de posi√ß√£o. O sistema converte para `?` se `DB_TYPE=sqlserver`. A **ordem** dos `%s` deve corresponder √† ordem dos par√¢metros listados abaixo.

**Refer√™ncia Detalhada das Queries:**

Aqui est√° a descri√ß√£o de cada *query* esperada, os par√¢metros que a aplica√ß√£o ir√° passar (na ordem correta) e as colunas de sa√≠da obrigat√≥rias (os nomes referem-se aos **valores** na sec√ß√£o `"columns"`).

-----

  * **`get_specialties`**
      * **Prop√≥sito:** Lista de especialidades para o menu de sele√ß√£o.
      * **Par√¢metros:** Nenhum.
      * **Colunas Obrigat√≥rias:** `COD_ESPECIALIDADE`, `DES_ESPECIALIDADE`.

-----

  * **`get_recent_patients`**
      * **Prop√≥sito:** Busca os 10 utentes mais recentes (base query).
      * **Par√¢metros:**
        1.  `specialty_id` (Opcional - adicionado dinamicamente pela DAL se fornecido).
      * **Colunas Obrigat√≥rias:** `INT_EPISODIO`, `COD_SALA`, `NUM_CAMA`, `NOME`.

-----

  * **`get_patient_list_base`**
      * **Prop√≥sito:** Base para a lista paginada de utentes.
      * **Par√¢metros:** Nenhum (filtros e pagina√ß√£o s√£o adicionados dinamicamente pela DAL).
      * **Colunas Obrigat√≥rias:** `INT_EPISODIO`, `COD_SALA`, `NUM_CAMA`, `DTA_ENTRADA`, `HORA_ENTRADA`, `NOME`.

-----

  * **`get_patient_list_count_base`**
      * **Prop√≥sito:** Base para contar o total de utentes (para pagina√ß√£o).
      * **Par√¢metros:** Nenhum (filtros s√£o adicionados dinamicamente pela DAL).
      * **Colunas Obrigat√≥rias:** `TOTAL`.

-----

  * **`get_patient_details`**
      * **Prop√≥sito:** Busca dados de cabe√ßalho e especialidade de um utente (base query).
      * **Par√¢metros:**
        1.  `patient_id` (ID do epis√≥dio).
        2.  `specialty_id` (Opcional - adicionado dinamicamente pela DAL se fornecido para valida√ß√£o).
      * **Colunas Obrigat√≥rias:** `INT_EPISODIO`, `DTA_ENTRADA`, `HORA_ENTRADA`, `COD_SALA`, `NUM_CAMA`, `NOME`, `DES_ESPECIALIDADE`.

-----

  * **`get_patient_id_by_name`**
      * **Prop√≥sito:** Encontra o ID do utente mais recente por nome (base query).
      * **Par√¢metros:**
        1.  `specialty_id` (Opcional - adicionado dinamicamente pela DAL se fornecido).
        2.  `patient_name` (Para a cl√°usula `LIKE`).
      * **Colunas Obrigat√≥rias:** `INT_EPISODIO`.

-----

  * **`get_all_patient_ids`**
      * **Prop√≥sito:** Lista todos os IDs para o backup peri√≥dico (base query).
      * **Par√¢metros:**
        1.  `specialty_id` (Opcional - adicionado dinamicamente pela DAL se um backup por especialidade for implementado no futuro).
      * **Colunas Obrigat√≥rias:** `INT_EPISODIO`.

-----

  * **Queries Dependentes Apenas de `patient_id` (ID do Epis√≥dio):**
      * `get_ainicial_items`: **Params:** `patient_id`, `antecedentes_code`, `diagnostico_code`. **Cols:** `ITEM`, `VALOR`.
      * `get_telefone`: **Params:** `patient_id`. **Cols:** `TEL_MORADA`, `NR_TELM`.
      * `get_pessoa_signif`: **Params:** `patient_id`. **Cols:** `PESSOA`.
      * `get_observacoes`: **Params:** `patient_id`. **Cols:** `OBSERVACOES`.
      * `get_fenomenos`: **Params:** `patient_id`. **Cols:** `DATA_INICIO_FENOM`, `HORA_INICIO_FENOM`, `FENOMENO_PT`, `ESPECIFICACAO`.
      * `get_medicacao`: **Params:** `patient_id`. **Cols:** `DOSE`, `HORARIO`, `FARMACO`, `VIA`.
      * `get_atitudes`: **Params:** `patient_id`. **Cols:** `ATITUDETERAPEUTICA`, `HORARIO_ATITUDE`.
      * `get_analises`: **Params:** `patient_id`. **Cols:** `ANALISE`, `DATA_INICIO_ANALISE`, `HORA_INICIO_ANALISE`.
      * `get_exames`: **Params:** `patient_id`. **Cols:** `EXAME`, `DATA_MARCACAO`.
      * `get_diarios`: **Params:** `patient_id`. **Cols:** `DATA_DIARIO`, `HORA_DIARIO`, `DIARIO`.
      * `get_ultimo_diario_chave`: **Params:** `patient_id`. **Cols:** `DATA_DIARIO`, `HORA_DIARIO`.
      * `get_ultimo_diario_texto`: **Params:** `patient_id`, `data_ultimo_diario`, `hora_ultimo_diario`. **Cols:** `ULT_DIARIO`.

-----

**Exemplo Completo (`config.json`):**
Consulte o ficheiro `configs/config.example.json` no reposit√≥rio para um exemplo completo da estrutura esperada.

-----

## üåê Acesso aos Servi√ßos

| Servi√ßo               | URL                     | Descri√ß√£o                    |
| :-------------------- | :---------------------- | :--------------------------- |
| **Aplica√ß√£o Web** | `http://localhost:8000`   | Interface principal          |
| **Admin Django** | `http://localhost:8000/admin` | Gest√£o de utilizadores       |
| **RabbitMQ Management** | `http://localhost:15672`  | Monitoriza√ß√£o de filas Celery |

**Credenciais RabbitMQ:** Use as definidas em `RABBITMQ_DEFAULT_USER` / `RABBITMQ_DEFAULT_PASS` no seu `.env`.

-----

## üìê Arquitetura T√©cnica Detalhada

### 1\. Vis√£o Geral

Aplica√ß√£o web modular e resiliente para consulta de dados cl√≠nicos e conting√™ncia offline via PDFs. Arquitetura baseada em microservi√ßos orquestrados por Docker Compose.

**Componentes:** Nginx (Proxy), Django/Gunicorn (Web App), Celery Worker(s) (Tarefas Background), Celery Beat (Agendador), RabbitMQ (Fila), SQLite (BD Interna), BD Hospitalar (Externa).

### 2\. Decis√µes Arquitet√≥nicas Chave

  * **Camada de Acesso a Dados (DAL) Modular (`dal.py`):** Isola acesso √† BD externa, configur√°vel via `config.json` (queries, colunas), usa queries parametrizadas, padroniza dados internamente. L√≥gica din√¢mica para filtros (`specialty_id`), ordena√ß√£o e pagina√ß√£o.
  * **Arquitetura Multi-Base de Dados (`settings.py`, `dbrouters.py`):** Garante acesso *read-only* √† BD hospitalar (`hospital`) e usa BD interna (`default` - SQLite) para utilizadores/sess√µes. `HospitalRouter` direciona queries e bloqueia escritas/migra√ß√µes na BD externa.
  * **Processamento Ass√≠ncrono (`celery.py`, `tasks.py`):** Celery/RabbitMQ para tarefas longas (gera√ß√£o PDFs) sem bloquear a interface. Celery Beat agenda backups peri√≥dicos (`BACKUP_INTERVAL`). Padr√£o Fan-Out (`gerar_backup_pdfs_periodico` -\> N x `gerar_pdf_para_utente`) para resili√™ncia e paralelismo. Tarefa `gerar_pdf_para_utente` inclui retentativas (`self.retry`).
  * **Gera√ß√£o de PDFs (`pdf_utils.py`, `tasks.py`, `patient-pdf.html`):** WeasyPrint converte HTML+CSS (gerado por template Django) para PDF. Armazenamento hier√°rquico (`<Especialidade>/<Sala>/<Cama>_<ID>_<Nome>.pdf`).
  * **Containeriza√ß√£o e Orquestra√ß√£o (`Dockerfile`, `docker-compose.yml`):**
      * `Dockerfile`: Multi-stage build, instala√ß√£o condicional de cliente BD (`ARG DB_TYPE`), utilizador n√£o-root (`app`).
      * `docker-compose.yml`: Define servi√ßos, volumes din√¢micos (PDFs via `${HOST_BACKUP_DIR}`), rede interna, healthchecks e `depends_on: condition: service_healthy`.
  * **Gest√£o de Estado (`views.py`, Sess√µes Django):** Sele√ß√£o de contexto (especialidade ou "Ver Todos") guardada na sess√£o (`selected_specialty_id`, `selected_specialty_name`). Views verificam `selected_specialty_name` para acesso e passam `selected_specialty_id` (ou `None`) para a DAL filtrar dados.

-----

## üöÄ Deployment em Produ√ß√£o (Notas)

Implementar em produ√ß√£o requer cuidados adicionais. Pontos principais:

  * **Servidor:** Linux com Docker/Compose, recursos adequados.
  * **Configura√ß√£o `.env`:** Usar ficheiro espec√≠fico de produ√ß√£o (`DJANGO_DEBUG=False`, `ALLOWED_HOSTS` corretos, passwords fortes). Considerar gest√£o de segredos.
  * **Nginx:** Configurar HTTPS (SSL/TLS), servir ficheiros est√°ticos, headers de seguran√ßa.
  * **Gunicorn:** Ajustar n√∫mero de `workers`/`threads` consoante os recursos do servidor.
  * **Celery:** Ajustar `concurrency`, escalar `workers` se necess√°rio. Monitorizar filas (RabbitMQ UI, Flower).
  * **Persist√™ncia e Backups:** O diret√≥rio `HOST_BACKUP_DIR` **DEVE** estar inclu√≠do na rotina de backups do hospital. Fazer backup do volume `rabbitmq_data` e do ficheiro `db.sqlite3`.
  * **Logging/Monitoriza√ß√£o:** Centralizar logs, monitorizar recursos dos contentores.
  * **Processo de Atualiza√ß√£o:** `git pull`, `docker compose build` (se necess√°rio), `migrate`, `collectstatic`, `docker compose down && docker compose up -d`.
  * **Valida√ß√£o:** Testes extensivos com utilizadores finais, plano de conting√™ncia, conformidade RGPD/legisla√ß√£o.

-----

## üîß Comandos √öteis

**Gest√£o de Servi√ßos:**

```bash
# Parar todos os servi√ßos
docker compose down

# Parar e remover volumes (CUIDADO: apaga dados do RabbitMQ e SQLite interno)
docker compose down --volumes

# Reiniciar um servi√ßo espec√≠fico
docker compose restart web

# Ver logs de um servi√ßo
docker compose logs -f celery

# Executar comando Django (ex: migra√ß√µes da BD interna)
docker compose exec web python manage.py migrate
```

**Gest√£o de Utilizadores:**

```bash
# Criar superutilizador
docker compose exec web python manage.py createsuperuser

# Criar outros utilizadores via admin: http://localhost:8000/admin
```

**Otimiza√ß√£o de Performance:**

  * **Aumentar processos por worker Celery:** Edite `docker-compose.yml` e adicione `--concurrency=N` ao `command` do servi√ßo `celery`.
  * **Escalar workers horizontalmente:** `docker compose up -d --scale celery=3` (para 3 workers).

-----

## üß™ Testes (Exemplo)

```bash
# Executar suite de testes (se configurada)
docker compose exec web python manage.py test

# Executar com coverage (se configurado)
docker compose exec web coverage run --source='.' manage.py test
docker compose exec web coverage report
```

-----

## üêõ Troubleshooting

  * **Problema: Aplica√ß√£o n√£o inicia**
      * Verifique os logs: `docker compose logs web`
      * Verifique a conectividade √† BD externa a partir do container:
        ```bash
        docker compose exec web bash
        # Dentro do container, tente usar nc ou telnet, se dispon√≠veis
        nc -zv <HOST_DA_BD> <PORTA_DA_BD>
        exit
        ```
      * Confirme se a VPN est√° ativa (se necess√°rio).
  * **Problema: PDFs n√£o s√£o gerados**
      * Verifique os logs do Celery: `docker compose logs celery`
      * Verifique a fila RabbitMQ: Aceda a `http://localhost:15672`
  * **Problema: Queries SQL falham (`ORA-xxxx`, etc.)**
      * Verifique se as colunas de *output* e nomes em `configs/config.json` correspondem exatamente ao esperado.
      * Confirme a compatibilidade da sintaxe SQL com o seu SGBD.
      * Teste as *queries* diretamente na base de dados.
      * Verifique se as credenciais no `.env` (especialmente `SQL_DSN`) est√£o corretas.

-----

## üìä Estrutura do Projeto

```
ward-data-portal/
‚îú‚îÄ‚îÄ configs/
‚îÇ   ‚îú‚îÄ‚îÄ config.json               # ‚ö†Ô∏è Ficheiro de configura√ß√£o REAL (editar aqui)
‚îú‚îÄ‚îÄ dadosenfermaria/              # Aplica√ß√£o Django principal
‚îÇ   ‚îú‚îÄ‚îÄ migrations/               # Migra√ß√µes da BD interna (SQLite)
‚îÇ   ‚îú‚îÄ‚îÄ templates/                # Templates HTML
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ dadosenfermaria/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ select-specialty.html # Nova p√°gina de sele√ß√£o
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ ... (outros templates)
‚îÇ   ‚îú‚îÄ‚îÄ dal.py                    # Data Access Layer (l√≥gica BD externa)
‚îÇ   ‚îú‚îÄ‚îÄ tasks.py                  # Tarefas Celery (gera√ß√£o PDF)
‚îÇ   ‚îú‚îÄ‚îÄ views.py                  # Views Django (l√≥gica HTTP)
‚îÇ   ‚îú‚îÄ‚îÄ pdf_utils.py              # Utilit√°rios de formata√ß√£o para PDF
‚îÇ   ‚îî‚îÄ‚îÄ ... (outros ficheiros da app)
‚îú‚îÄ‚îÄ project/                      # Configura√ß√£o global do projeto Django
‚îÇ   ‚îú‚îÄ‚îÄ settings.py               # Configura√ß√µes principais
‚îÇ   ‚îú‚îÄ‚îÄ celery.py                 # Configura√ß√£o do Celery
‚îÇ   ‚îú‚îÄ‚îÄ dbrouters.py              # Router para multi-BD
‚îÇ   ‚îî‚îÄ‚îÄ urls.py                   # Mapeamento de URLs
‚îú‚îÄ‚îÄ static/                       # Ficheiros est√°ticos (CSS, JS)
‚îÇ   ‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îî‚îÄ‚îÄ js/
‚îú‚îÄ‚îÄ nginx/                        # Configura√ß√£o do Nginx
‚îÇ   ‚îî‚îÄ‚îÄ nginx.conf
‚îú‚îÄ‚îÄ Dockerfile                    # Instru√ß√µes para construir a imagem Docker
‚îú‚îÄ‚îÄ docker-compose.yml            # Orquestra√ß√£o dos servi√ßos
‚îú‚îÄ‚îÄ requirements.txt              # Depend√™ncias Python
‚îú‚îÄ‚îÄ manage.py                     # Utilit√°rio de gest√£o Django
‚îú‚îÄ‚îÄ .env.example                  # Template das vari√°veis de ambiente
‚îú‚îÄ‚îÄ .env                          # ‚ö†Ô∏è Ficheiro real das vari√°veis (N√ÉO versionar)
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ LICENSE
‚îî‚îÄ‚îÄ README.md                     # Este ficheiro
```

-----

## ü§ù Contribui√ß√µes

Este projeto foi desenvolvido num contexto acad√©mico. Contribui√ß√µes, *forks* e sugest√µes s√£o bem-vindas, especialmente nas seguintes √°reas:

  * üåç Internacionaliza√ß√£o (i18n) da interface.
  * üîê Integra√ß√£o com sistemas de SSO (LDAP, SAML).
  * üîå Suporte para standards de interoperabilidade (HL7 FHIR).
  * ‚úÖ Expans√£o da cobertura de testes automatizados.

-----

## üìù Licen√ßa

Este projeto est√° licenciado sob a **MIT License** - consulte o ficheiro `LICENSE` para detalhes.

-----

## üìñ Cita√ß√£o

Se utilizar este trabalho na sua investiga√ß√£o ou projeto, por favor cite:

**BibTeX:**

```bibtex
@mastersthesis{moraes2025ward,
  author  = {Moraes, Bernardo Tardin de},
  title   = {Gest√£o Inteligente e Inovadora de Enfermarias: Solu√ß√£o para Continua√ß√£o de Cuidados},
  school  = {Universidade do Minho},
  year    = {2025},
  address = {Braga, Portugal},
  type    = {Disserta√ß√£o de Mestrado},
  note    = {Mestrado em Engenharia Biom√©dica (Inform√°tica M√©dica)}
}
```

-----

## üìß Contacto

  * **Bernardo Tardin de Moraes:** pg53700@alunos.uminho.pt
  * **Institui√ß√£o:** Universidade do Minho - Escola de Engenharia

-----

## ‚ö†Ô∏è Aviso Legal

Este sistema foi desenvolvido para fins acad√©micos e de investiga√ß√£o. A sua implementa√ß√£o em ambiente de produ√ß√£o hospitalar deve ser precedida de auditoria de seguran√ßa completa, valida√ß√£o cl√≠nica por profissionais de sa√∫de no contexto real, cumprimento da regulamenta√ß√£o (RGPD, legisla√ß√£o nacional) e processos de certifica√ß√£o apropriados. O autor e a Universidade do Minho n√£o se responsabilizam por implementa√ß√µes inadequadas ou uso indevido do sistema.

```
```